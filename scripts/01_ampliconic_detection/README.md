# Ampliconic Gene Family Detection

This directory contains scripts for identifying and analyzing ampliconic gene families across primate species.

## Scripts Overview

### 1. `multicopy_ampliconic_genes.ipynb`
**Attribution:** This script is adapted from Makova et al., 2024 (DOI: https://doi.org/10.1038/s41586-024-07473-2], GitHub: https://github.com/makovalab-psu/T2T_primate_XY/tree/main/multicopy_genes.

**Modifications:** The original script has been adapted to include an additional primate species (Macaca fascicularis) in the analysis and only filter for ampliconic families at the end.


**Input files used for the Multicopy- ampliconic gene detection:**
- Telomere-2-telemore reference genome assemblies:
  - Gorilla: https://www.ncbi.nlm.nih.gov/datasets/genome/GCF_029281585.2/
  - Human: https://www.ncbi.nlm.nih.gov/datasets/genome/GCF_009914755.1/
  - Bonobo: https://www.ncbi.nlm.nih.gov/datasets/genome/GCF_029289425.2/
  - Chimpanzee: https://www.ncbi.nlm.nih.gov/datasets/genome/GCF_028858775.2/
  - Bornean orangutan: https://www.ncbi.nlm.nih.gov/datasets/genome/GCF_028885625.2/
  - Sumatran orangutan: https://www.ncbi.nlm.nih.gov/datasets/genome/GCF_028885655.2/
  - Siamang: https://www.ncbi.nlm.nih.gov/datasets/genome/GCF_028878055.3/
  - Crab-eating macaque: https://www.ncbi.nlm.nih.gov/datasets/genome/GCF_037993035.2/
- Palindrome annotation file from Makova et al. 2024 (available at their GitHub and in `data/raw/palindromes/`)
- Sequence classification file from Makova et al. 2024 (available at their GitHub and in `data/raw/palindromes/`)

**Output:**
- `gene_details` files for X and Y chromosomes containing information about all detected multicopy genes. See `data/intermediate/clusters/` for the files. 

These gene_details files are together with the reference genomes used as input for the clustering scripts below. 


### 2. `clustering_ampliconic_X.ipynb` and `clustering_ampliconic_Y.ipynb`
Identifies ampliconic gene family clusters on the X and Y chromosomes. Makes alignments of these ampliconic clusters and calculates dN/dS ratios on each alignment. 

**Input:**
- `gene_details` files generated by `multicopy_ampliconic_genes.ipynb`
- Telomere-2-telemore reference genome assemblies

**Output:**
- Ampliconic gene family clusters across all species
- Extracted coding sequences for each cluster
- Multiple sequence alignments for each ampliconic cluster
- Pairwise dN/dS estimates (large table, combined with bootstrapped estimates). For this MEGA is used, see control files in `scripts/01_ampliconic/detection/MEGA_control_files`. 
- `all_families_gene_details_with_clusters` file (gene details with cluster assignments)
- `cluster_counts_per_species` files (summary of cluster copy numbers)

The alignment files generated here are used as input for `bootstrap_dnds.py` and for gene conversion analysis (see `scripts/03_gene_conversion/`).



### 3. `bootstrap_dnds.py`
Performs bootstrap resampling to generate confidence intervals for pairwise dN/dS estimates.

**Input:**
- Cluster alignment files from `clustering_ampliconic_X.ipynb` and `clustering_ampliconic_Y.ipynb`

**Output:**
- Bootstrapped pairwise dN/dS estimates
- This table is combined with the initial dN/dS estimates from the clustering scripts

## Workflow Summary
```
Reference genomes + Palindrome/Sequence Class files
          ↓
    multicopy_genes.ipynb
          ↓
    gene_details files
          ↓
clustering_X.ipynb + clustering_Y.ipynb
          ↓
Alignments + cluster info + dN/dS estimates
          ↓
    bootstrap_dnds.py
          ↓
Final bootstrapped dN/dS table
```

## Notes on Multicopy_ampliconic_genes.ipynb
The palindrome annotation files from Makova et al., 2024 are included in `data/raw/palindromes/` for reproducibility.
If you use the multicopy gene detection approach, please cite:
Makova, K.D., Pickett, B.D., Harris, R.S. et al. The complete sequence and comparative analysis of ape sex chromosomes. Nature 630, 401–411 (2024). https://doi.org/10.1038/s41586-024-07473-2


