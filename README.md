# Ampliconic Gene Evolution in Primates

This repository contains all code and data files for the manuscript "Pervasive positive selection on X-linked ampliconic genes in primates"

## Overview

This study investigates the evolution of ampliconic gene families on primate sex chromosomes, examining patterns of gene amplification, positive selection, and gene conversion across multiple primate species.

## Repository Structure
```
.
├── data/
│   ├── raw/                          # Input data
│   │   ├── palindromes/              # Palindrome + sequence class annotations (Makova et al., 2024)
│   │   └── expression/               # Gene expression data
│   ├── reference/                    # Reference files used across analyses
│   │   ├── Amplicon_summary_count_expression_genefamily.xlsx
│   │   └── protein_domains/          # Protein domain TSV files
│   └── intermediate/                 # Files generated by scripts
│       ├── gene_details/             # Multicopy gene annotations
│       ├── clusters/                 # Gene family cluster assignments
│       ├── cluster_counts/           # Cluster copy numbers per species
│       ├── alignments/               # Multiple sequence alignments
│       ├── dnds/                     # dN/dS ratio tables
│       └── paml/                     # PAML analysis outputs
├── scripts/
│   ├── 01_ampliconic_detection/      # Identify ampliconic gene families
│   ├── 02_selection/                 # Positive selection analyses
│   ├── 03_gene_conversion/           # Gene conversion detection
│   └── 04_figures/                   # Generate manuscript figures using intermediate files
├── results/
│   ├── figures/
│   │   ├── main/                     # Main figures 1-5
│   │   └── supplementary/            # Supplementary figures
│   └── tables/
│       └── supplementary/            # Supplementary tables
└── requirements.txt                  # Conda environment specification
```

## Analysis Workflow

### 1. Ampliconic Gene Family Detection (`scripts/01_ampliconic_detection/`)

Identifies multicopy genes and clusters them into ampliconic gene families.

**Key scripts:**
- `multicopy_ampliconic_genes.ipynb` - Detects multicopy genes (adapted from Makova et al. 2024)
- `clustering_ampliconic_X.ipynb` / `clustering_ampliconic_Y.ipynb` - Clusters genes into families
- `bootstrap_dnds.py` - Generates bootstrapped dN/dS estimates

**Outputs used in figures:**
- Gene family clusters → Figure 1, Figure 2, Supplementary Figures
- dN/dS estimates → Figure 1, selection heatmaps

See `scripts/01_ampliconic_detection/README.md` for details.

### 2. Selection Analysis (`scripts/02_selection/`)

Analyzes positive selection using PAML and visualizes selection patterns.

**Key scripts:**
- `PAML_site_tests.ipynb` - Site-specific selection tests
- `site_test_domain_mapping.R` - Maps selected sites to protein domains
- `selection_heatmap_phylogenies.R` - Visualizes dN/dS patterns

**Outputs used in figures:**
- Site test results → Figure 1d,e (bubble plot), Figure 5
- Domain mapping → Figure 5, Supplementary Figure 7
- dN/dS heatmaps → Selection analysis figures, Figure 4

See `scripts/02_selection/README.md` for details.

### 3. Gene Conversion Analysis (`scripts/03_gene_conversion/`)

Detects gene conversion by analyzing sequence similarity and GC content patterns.

**Key script:**
- `gene_conversion_tests.ipynb` - Complete gene conversion analysis pipeline

**Outputs used in figures:**
- Gene conversion patterns → Figure 3
- Summary statistics → Supplementary Table 6

See `scripts/03_gene_conversion/README.md` for details.

### 4. Figure Generation (`scripts/04_figures/`)

Scripts to generate manuscript figures from analysis results.

**Main Figures:**
- **Figure 1** - `ampliconic_evolution_XY_plot.R`: Tile and bubble plots showing gene family evolution
- **Figure 2** - `XY_gene_family_synteny.R`: Synteny patterns of ampliconic families
- **Figure 3** - Generated by `scripts/03_gene_conversion/gene_conversion_tests.ipynb`: Gene conversion analysis
- **Figure 4** - Generated by `scripts/02_selection/selection_heatmap_phylogenies.R`: dN/dS heatmaps and phylogenies
- **Figure 5** - Generated by `scripts/02_selection/site_test_domain_mapping.R`: Domain structure with positive selection sites
  
**Supplementary Figures:**
- **Supp Figs 1, 4, 5, 6** - `supplementaryfigures.R`: Copy number, expression, and genomic organization X and Y
- **Supp Fig 2** - `suppfig2_expression.ipynb`: Expression analysis
- **Supp Fig 3** - Generated by `XY_gene_family_synteny.R`: Additional synteny patterns
- **Supp Fig 7** - Generated by `scripts/02_selection/site_test_domain_mapping.R`: Additional domain plots

See individual README files in each scripts subdirectory for detailed information.


### Requirements

All python libraries installed in conda env used to run this notebook are listed in `requirements.txt`.


## Data Availability

### Reference Genomes

All telomere-to-telomere reference genome assemblies are publicly available from NCBI:

- **Human** (*Homo sapiens*): https://www.ncbi.nlm.nih.gov/datasets/genome/GCF_009914755.1/
- **Chimpanzee** (*Pan troglodytes*): https://www.ncbi.nlm.nih.gov/datasets/genome/GCF_028858775.2/
- **Bonobo** (*Pan paniscus*): https://www.ncbi.nlm.nih.gov/datasets/genome/GCF_029289425.2/
- **Gorilla** (*Gorilla gorilla*): https://www.ncbi.nlm.nih.gov/datasets/genome/GCF_029281585.2/
- **Bornean orangutan** (*Pongo pygmaeus*): https://www.ncbi.nlm.nih.gov/datasets/genome/GCF_028885625.2/
- **Sumatran orangutan** (*Pongo abelii*): https://www.ncbi.nlm.nih.gov/datasets/genome/GCF_028885655.2/
- **Siamang** (*Symphalangus syndactylus*): https://www.ncbi.nlm.nih.gov/datasets/genome/GCF_028878055.3/
- **Crab-eating macaque** (*Macaca fascicularis*): https://www.ncbi.nlm.nih.gov/datasets/genome/GCF_037993035.2/

### External Data Sources

- Palindrome and sequence class annotations: Makova et al. 2024 (DOI:https://doi.org/10.1038/s41586-024-07473-2)

## Citation
-- 


## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Contact

Emma Diepeveen - emdi@birc.au.dk

